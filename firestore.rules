rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Require App Check verification for the secret_messages collection
    match /secret_messages/{messageId} {
      
      // Allow reads and writes ONLY IF a valid App Check token is present.
      // This enforces that the request came from your legitimate app.
      allow read, write: if request.app != null;
      // allow read, write: if true;
      
      // Allow automatic deletion of expired messages (auto-expire after 1 hour)
      allow delete: if resource.data.expiresAt < request.time;
    }
    
    // NOTE: If you have other collections, you should add rules for them here.
  }
}